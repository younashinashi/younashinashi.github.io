<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Vaulta のリリースノート</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" content="#91C847">
  <meta name="description" content="Vaulta の更新履歴（リリースノート）。">

  <link rel="stylesheet" href="../styles.css">
  <link rel="icon" href="../assets/img/dev-icon.png">
</head>
<body>
  <header>
    <div class="container" style="display:flex; justify-content:space-between; gap:16px;">
      <a class="brand-link" href="../" aria-label="ホームへ">
        <img src="../assets/img/dev-icon.png" alt="公式サイトアイコン" class="brand__logo">
        <strong>公式サイト</strong>
      </a>
      <nav>
        <a href="./vaulta.html">アプリページ</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Vaulta のリリースノート</h1>
      <p class="small">最新順に並んでいます。</p>
    </section>

    <section id="list" class="grid" aria-live="polite"></section>
  </main>

  <footer>
    <div class="container small">
      <p>&copy; <span id="y"></span> YOUNASHINASHI. All Rights Reserved.</p>
    </div>
  </footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    async function main(){
      const container = document.getElementById('list');
      const url = '../data/releases/vaulta.json';
      try {
        const res = await fetch(url, {cache: 'no-store'});
        if(!res.ok) throw new Error('JSONの取得に失敗しました: ' + res.status);
        const data = await res.json();
        if(!Array.isArray(data)) throw new Error('JSON形式が不正です（配列ではありません）');

        if (data.length === 0) {
          container.innerHTML = '<p class="small">まだリリースはありません。</p>';
          return;
        }

        container.innerHTML = data.map(item => {
          const date = item.publishedAt ? new Date(item.publishedAt) : null;
          const d = date ? `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}` : '';
          const safeBody = (item.body || '').replace(/</g,'&lt;').replace(/>/g,'&gt;');
          return `
            <article class="card">
              <h3 style="margin-top:0;">${item.title || item.tag}</h3>
              <p class="small" style="margin:.2em 0 .8em; color:var(--muted);">
                ${item.versionName ? `Version ${item.versionName}` : ''}${item.versionCode ? ` (${item.versionCode})` : ''} ${d ? `・ ${d}` : ''}
              </p>
              <pre style="white-space:pre-wrap; margin:0;">${safeBody}</pre>
              <div style="margin-top:10px;">
                <a class="btn btn--ghost" href="${item.htmlUrl}" target="_blank" rel="noopener">GitHub Release を見る</a>
              </div>
            </article>
          `;
        }).join('');
      } catch (e) {
        console.error(e);
        container.innerHTML = `<p style="color:#c00;">読み込みエラー：${e.message}</p>`;
      }
    }
    main();
  </script>
</body>
</html>
